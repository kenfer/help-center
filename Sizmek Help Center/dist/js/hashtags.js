$(document).ready(function(){var e,s,a=HelpCenter.user.role;window.location.href.split("--")[0];if(-1!==jQuery.inArray("view_support_content",HelpCenter.user.tags)&&$("#user-menu").append("<a id='hashAdmin' role='menuitem' href='https://support.sizmek.com/hc/en-us/articles/360004850231-Hashtag-Management'>Hashtag Management</a>"),-1<window.location.href.indexOf("/articles/")&&"end_user"!=a&&"anonymous"!=a){var l,t,r=window.location.href.split("articles/")[1].split("#")[0].split("-")[0].split("?")[0];-1!==jQuery.inArray("view_support_content",HelpCenter.user.tags)&&($.get("/api/v2/help_center/articles/"+r+".json",function(a){t=a.article.section_id,$.get("/api/v2/help_center/sections/"+t+".json",function(a){n(l=a.section.category_id,t)})}),$(".article-wrapper").prepend('<div class="incident-wrapper"></div>'),$(".incident-wrapper").prepend('<div class="article-hashtags"></div>'),$("body").on("click","#hashBtn",function(){var a,e=[];$("#hashTxt").toggle("fast"),$("#hashTxt").focus(),""!=(a=$("#hashTxt").val().replace(/\s/g,""))&&(e.push(a),$("#hashTxt").val(""));for(var s=0;s<e.length;s++)$.ajax({url:"/api/v2/help_center/articles/"+r+"/labels.json",type:"POST",data:{label:{name:"Tags:"+e[s]}},success:function(){$(".tagList").remove(),$(".tagList").html(n(l,t)),$("#hashTxt").css("display","inline-block").focus()}})}),$("body").keypress(function(a){if(13===a.which&&"inline-block"===$("#hashTxt").css("display"))return $("#hashBtn").trigger("click"),!1}),$("body").on("click",".cssCircle.minusSign",function(a){a.stopPropagation();var e=$(this).find("span.hide").text();$("#query").val(""),$.ajax({url:"/api/v2/help_center/articles/"+r+"/labels/"+e+".json",type:"DELETE",success:function(){$(".tagList").remove(),$(".tagList").html(n(l,t))}})}),$("body").on("click","a.hashTags",function(){var a=$(this).find(".tagName:first").text();$("#query").val(a),$("#query").focus(),window.location.href="https://support.sizmek.com/hc/en-us/search?utf8=%E2%9C%93&query="+encodeURIComponent(a)+"&commit=Search"}),"https://support.sizmek.com/hc/en-us/articles/360004850231-Hashtag-Management"==window.location.href&&($("footer.article-footer").remove(),$("form.comment-form").remove(),$(".article-comments").remove(),$(".article-body.markdown").remove(),$(".article-hashtags").remove(),$('<div class="hashtagHeader"></div>').insertAfter(".article-info"),$('<div class="hashtagList body"></div>').insertAfter(".hashtagHeader"),$("<div><input id='searchTag' type='text' placeholder='Im a search hashtag, and I have bugs...' style='width: 300px;'></div>").insertBefore(".user-nav"),$(".hashtagHeader").append("<div class='searchContainer' style='float: right;'><input id='sortTagBtn' type='button' value='Sort tags by...'></div>"),$(".searchContainer").append("<div class='sortOptions' style='display: none;'></div>"),e=[],s=[],$.get("/api/v2/help_center/articles/labels.json",function(a){e=$.map(a.labels,function(a){if("Tags:"==a.name.substr(0,5))return a.name.toLowerCase()}),$.each(e,function(a,e){-1==$.inArray(e,s)&&s.push(e)}),s.sort(),$(".hashtagHeader").append("<h2 style='margin-top: 20px;'>Hashtag Count: "+s.length+"</h2>"),$.each(s,function(a){var n,e=s[a].substr(5);$(".hashtagList.body").append("<h3 class='h3Tag'><p class='expanding'><a class='tag-"+e+"'>#"+e+"</a></p></h3><div class='expandingBlock' style='display: none; overflow: hidden;'><ul class='list-"+e+"'></ul>"),n=e,$.get("/api/v2/help_center/articles/search.json?label_names=Tags:"+n,function(a){var e=a.results,s=$(".expanding").find(".tag-"+n);s.text(s.text()+" ("+a.count+")");for(var t=0;t<e.length;t++)$(".expandingBlock ul.list-"+n).append("<li id='tagNum-"+t+"' style='background: #FAFAFA; overflow: auto;'><div class='tagData' style='float: left;'><a href='"+e[t].html_url+"'>"+e[t].name+"</a><span class='hide'>"+e[t].id+"</span></div></li>"),o(e[t].id,e[t].section_id,n,t)})})}),$("body").on("click","#sortTagBtn",function(){"none"==$(".sortOptions").css("display")?($(".sortOptions").css("display","block"),$(".sortOptions").append("<a class='optionBtn' href='#' data-value='alphaTag'>Alphabetical</a><br><a class='optionBtn' href='#' data-value='numTag'>No. of tags</a><br><a class='optionBtn' href='#' data-value='dateTag'>Update date</a>")):($(".sortOptions").css("display","none"),$(".sortOptions").empty())}),$("body").on("click",".h3Tag",i),$("body").keypress(function(a){if(13===a.which&&1==$("#searchTag").is(":focus")&&""!=$("#searchTag").val()){var e=$(".tag-"+$("#searchTag").val());return $("html,body").animate({scrollTop:e.offset().top},500),$("body").on("click",".h3Tag",i),!1}})))}function n(t,a){var i,n=[];$(".article-hashtags").append('<div class="tagList"><a id="hashBtn" style="font-weight: bold;">+</a><input list="recoHashtag" type="text" id="hashTxt" placeholder="Enter a term, keyword or tag..." style="display: none; margin: 0px 7px;"><datalist id="recoHashtag"></datalist></div>'),$(".article-body.markdown p").append('<div class="hidden-tags hide"><ul></ul></div>'),$.get("/api/v2/help_center/articles/"+r+"/labels.json",function(a){for(var e=1,s=0;s<a.labels.length;s++)"Tags:"==a.labels[s].name.substr(0,5)&&($('<a class="hashTags" id="hash-'+e+'"><div class="cssCircle minusSign" style="display: none; background: #ff0000;">&#8211;<span class="hide">'+a.labels[s].id+'</span></div><div class="tagName">#'+a.labels[s].name.substr(5)+'</div><span class="hide">'+t+"</span></a>").insertAfter("#recoHashtag"),$(".hidden-tags ul").append("<li>"+a.labels[s].name+"</li>"),e++,n.push(a.labels[s].name.substr(5).toLowerCase()))}),i=n,$.get("/api/v2/help_center/categories/"+l+"/articles.json?sort_by=updated_at&sort_order=desc",function(a){for(var e=[],s=0;s<a.articles.length;s++)for(var t=0;t<a.articles[s].label_names.length;t++)"Tags:"==a.articles[s].label_names[t].substr(0,5)&&e.push(a.articles[s].label_names[t].substr(5).toLowerCase());var e=e.filter(function(a){return!this.has(a)},new Set(i)),n=[];$.each(e,function(a,e){-1==$.inArray(e,n)&&n.push(e)});for(var s=0;s<n.length;s++)$("#recoHashtag").append('<option value="'+n[s]+'"/>')})}function i(){var a=$(this).next(".expandingBlock");"none"==a.css("display")?(a.slideDown("fast"),a.css("display","block")):(a.slideUp("fast"),setTimeout(function(){a.css("display","none")},500))}function o(i,a,e,l){$.get("/api/v2/help_center/sections/"+a+".json",function(a){var n=".expandingBlock ul.list-"+e+" li#tagNum-"+l;$(n+" .tagData").append("<div class='sectCatName' style='font-size: 11px; margin-top: 7px;'><a href='"+a.section.html_url+"'>"+a.section.name+"</a></div>"),$.get("/api/v2/help_center/categories/"+a.section.category_id+".json",function(a){var t,e,s;$(n+" .sectCatName").prepend("<a href='"+a.category.html_url+"'>"+a.category.name+"</a> > "),t=n,e=i,s=l,$('<div class="tagList" style="float: right;"><a id="hashBtn-'+s+'" style="font-weight: bold; font-size: 11px; display: inline-block;">+</a><input list="recoHashtag" type="text" id="hashTxt-'+s+'" placeholder="Enter a term, keyword or tag..." style="display: none; margin: 0px 7px; font-size: 11px; width: 200px;"><datalist id="recoHashtag"></datalist></div>').insertAfter(t+" .tagData"),setTimeout(function(){$.get("/api/v2/help_center/articles/"+e+"/labels.json",function(a){for(var e=1,s=0;s<a.labels.length;s++)"Tags:"==a.labels[s].name.substr(0,5)&&($(t+" .tagList").append('<a class="hashTags" id="hash-'+e+'" style="font-size: 11px;"><div class="cssCircle minusSignDiff" style="display: none; background: #ff0000;">&#8211;<span class="hide">'+a.labels[s].id+'</span></div><div class="cssCircle editTag" style="display: none; background: #1a75ff;">*<span class="hide">'+a.labels[s].id+'</span></div><div class="tagName">#'+a.labels[s].name.substr(5)+"</div></a>"),e++)})},500)})})}});