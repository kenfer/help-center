function scrollUp(){$("html, body").animate({scrollTop:0},"500"),$("#backToTop").animate({opacity:0,height:"0px"},100)}var getUrlParameter=function(e){var t,a,o=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<o.length;a++)if((t=o[a].split("="))[0]===e)return void 0===t[1]||t[1]};$(document).ready(function(){var i=function(e){var t=e;return t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/[\u2018\u2019\u201A]/g,"'")).replace(/[\u201C\u201D\u201E]/g,'"')).replace(/\u2026/g,"...")).replace(/[\u2013\u2014]/g,"-")).replace(/\u02C6/g,"^")).replace(/\u2039/g,"<")).replace(/\u203A/g,">")).replace(/â€˜/g,"'")).replace(/â€™/g,"'")).replace(/â€œ/g,'"')).replace(/â€/g,'"')};function f(e,t){switch(t){case"good":e.css("border-top","1px solid #8DDE6C"),e.css("background-color","#EDFFE5");break;case"error":e.css("border-top","1px solid #FFB9A4"),e.css("background-color","#FFEEE7");break;default:e.css("border-top","1px solid #A4F1FF"),e.css("background-color","#F5FFFD")}}function t(e,t,a){$("#"+e+"BackupStatus").text("Your download will commence shortly.");var o="object"!=typeof t?JSON.parse(t):t,n="",r=[];if(a){var i="",c=0;for(var s in o[0])"body"!=s&&"name"!=s&&"title"!=s&&"description"!=s||r.push(c),i+=s+",",c++;n+=(i=i.slice(0,-1))+"\r\n"}for(var d=0;d<o.length;d++){i="",c=0;for(var s in o[d])-1<$.inArray(c,r)?i+='"'+encodeURIComponent(o[d][s])+'",':i+='"'+o[d][s]+'",',c++;i.slice(0,i.length-1),n+=i+"\r\n"}if(""==n)return f($("#"+e+"BackupStatus"),"error"),void $("#"+e+"BackupStatus").text("Backup failed. Process interrupted.");var l=document.createElement("a");l.id="csvDownloadLink",document.body.appendChild(l),blob=new Blob([n],{type:"text/csv"});var p=window.webkitURL.createObjectURL(blob),g=new Date,u="backup_"+e+"_"+(g.getFullYear()+"_"+g.getMonth()+"_"+g.getDate()+"_"+g.getHours()+"_"+g.getMinutes()+"_"+g.getSeconds())+".csv";$("#csvDownloadLink").attr({download:u,href:p}),$("#csvDownloadLink")[0].click(),document.body.removeChild(l),f($("#"+e+"BackupStatus"),"good"),$("#"+e+"BackupStatus").text("Backup completed successfully.")}$("textarea").change(function(){-1<$(this).attr("id").indexOf("Log")&&$(this).scrollTop($(this)[0].scrollHeight-$(this).height())}),$("#nxtArticles").click(function(){var o,n="/api/v2/help_center/articles/search.json?query=NXT,@NXT,MDX-NXT&per_page=20",r=0;f($("#nxtArticlesStatus"),"ready"),$("#nxtArticlesStatus").text("Processing... please wait."),function a(){$.get(n).done(function(e){(o=void 0===o?e.results:o.concat(e.results)).forEach(function(e){e.name=i(e.name),e.description&&(e.body=i(e.body))});var t=Math.floor(e.page/e.page_count*100)+"%";$("#nxtBackupStatus").text("Processing... "+t+" complete."),null!==(n=e.next_page)?(n+="&per_page=20",a()):r=1})}();var e=setInterval(function(){if(r){if(clearInterval(e),""==o)return;t("nxtArticles",o,!0)}},100)}),$("#categoryBackup").click(function(){var o,n="/api/v2/help_center/categories.json?per_page=20",r=0;f($("#categoryBackupStatus"),"ready"),$("#categoryBackupStatus").text("Processing... please wait."),function a(){$.get(n).done(function(e){(o=void 0===o?e.categories:o.concat(e.categories)).forEach(function(e){e.name=i(e.name),e.description&&(e.description=i(e.description))});var t=Math.floor(e.page/e.page_count*100)+"%";$("#categoryBackupStatus").text("Processing... "+t+" complete."),null!==(n=e.next_page)?(n+="&per_page=20",a()):r=1})}();var e=setInterval(function(){if(r){if(clearInterval(e),""==o)return;t("category",o,!0)}},100)}),$("#sectionBackup").click(function(){var o,n="/api/v2/help_center/sections.json?per_page=20",r=0;f($("#sectionBackupStatus"),"ready"),$("#sectionBackupStatus").text("Processing... please wait."),function a(){$.get(n).done(function(e){(o=void 0===o?e.sections:o.concat(e.sections)).forEach(function(e){e.name=i(e.name),e.description&&(e.description=i(e.description))});var t=Math.floor(e.page/e.page_count*100)+"%";$("#sectionBackupStatus").text("Processing... "+t+" complete."),null!==(n=e.next_page)?(n+="&per_page=20",a()):r=1})}();var e=setInterval(function(){if(r){if(clearInterval(e),""==o)return;t("section",o,!0)}},100)}),$("#articleBackup").click(function(){var o,n="/api/v2/help_center/articles.json?per_page=20",r=0;f($("#articleBackupStatus"),"ready"),$("#articleBackupStatus").text("Processing... please wait."),function a(){$.get(n).done(function(e){(o=void 0===o?e.articles:o.concat(e.articles)).forEach(function(e){e.name=i(e.name),e.title=i(e.title),e.body&&(e.body=i(e.body))});var t=Math.floor(e.page/e.page_count*100)+"%";$("#articleBackupStatus").text("Processing... "+t+" complete."),null!==(n=e.next_page)?(n+="&per_page=20",a()):r=1})}();var e=setInterval(function(){if(r){if(clearInterval(e),""==o)return;t("article",o,!0)}},100)});var o,e,u,y,v,h=0,m=0,b=0;function n(a,e){var t;if(0,h+=a.data.length,(u=e).pause(),"category"==y){t="/api/v2/help_center/categories.json";var o={category:{position:a.data[0].position,locale:a.data[0].locale,name:decodeURIComponent(a.data[0].name),description:decodeURIComponent(a.data[0].description)}};-1==decodeURIComponent(a.data[0].name).indexOf("@hc-admin")?$.ajax({url:t,type:"POST",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(o),success:function(e){m++,f(v,"ready"),v.text("New category (ID:"+e.category.id+") created successfully."),$("#"+y+"Log").val($("#"+y+"Log").val()+"New category (ID:"+e.category.id+") created successfully.\n").trigger("change");var t={category:{description:e.category.description+" MAP-ID:"+a.data[0].id}};$.ajax({url:"/api/v2/help_center/categories/"+e.category.id+".json",type:"PUT",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(t),success:function(e){f(v,"ready"),v.text("Old category (ID:"+a.data[0].id+") mapped to new category (ID:"+e.category.id+")."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Old category (ID:"+a.data[0].id+") mapped to new category (ID:"+e.category.id+").\n").trigger("change"),u.resume()},error:function(){f(v,"error"),v.text("Failed to update the new category description with mapping ID for old category (ID:"+a.data[0].id+")."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Failed to update the new category description with mapping ID for old category (ID:"+a.data[0].id+").\n").trigger("change"),u.resume()}})},error:function(){b++,f(v,"error"),v.text("Failed to create a new category for backup category (ID:"+a.data[0].id+")."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Failed to create a new category for backup category (ID:"+a.data[0].id+").\n").trigger("change"),u.resume()}}):(f(v,"ready"),v.text("Skipping category (ID:"+a.data[0].id+") since this is the Help Center Admin category."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Skipping category (ID:"+a.data[0].id+") since this is the Help Center Admin category.\n").trigger("change"),u.resume())}else if("section"==y){var n,r="/api/v2/help_center/categories.json?per_page=100",i=0,c=0;!function t(){$.get(r).done(function(e){n=void 0===n?e.categories:n.concat(e.categories),null!==(r=e.next_page)?(r+="&per_page=100",t()):i=1})}();var s=setInterval(function(){if(i){if(clearInterval(s),""==n)return;n.forEach(function(e){-1<e.description.indexOf("MAP-ID:"+a.data[0].category_id)&&(c=e.id)}),t="/api/v2/help_center/categories/"+c+"/sections.json";var e={section:{position:a.data[0].position,locale:a.data[0].locale,name:decodeURIComponent(a.data[0].name),description:decodeURIComponent(a.data[0].description)}};0<c?$.ajax({url:t,type:"POST",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(e),success:function(e){m++,f(v,"ready"),v.text("New section (ID:"+e.section.id+") created successfully."),$("#"+y+"Log").val($("#"+y+"Log").val()+"New section (ID:"+e.section.id+") created successfully.\n").trigger("change");var t={section:{description:e.section.description+" MAP-ID:"+a.data[0].id}};$.ajax({url:"/api/v2/help_center/sections/"+e.section.id+".json",type:"PUT",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(t),success:function(e){f(v,"ready"),v.text("Old section (ID:"+a.data[0].id+") mapped to new section (ID:"+e.section.id+")."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Old section (ID:"+a.data[0].id+") mapped to new section (ID:"+e.section.id+").\n").trigger("change"),u.resume()},error:function(){f(v,"error"),v.text("Failed to update the new section description with mapping ID for backup section (ID:"+a.data[0].id+")."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Failed to update the new section description with mapping ID for backup section (ID:"+a.data[0].id+").\n").trigger("change"),u.resume()}})},error:function(){b++,f(v,"error"),v.text("Failed to create a new section for backup section (ID:"+a.data[0].id+")."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Failed to create a new section for backup section (ID:"+a.data[0].id+").\n").trigger("change"),u.resume()}}):(f(v,"ready"),v.text("Skipping section (ID:"+a.data[0].id+") since it belongs to Help Center Admin category."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Skipping section (ID:"+a.data[0].id+") since it belongs to Help Center Admin category.\n").trigger("change"),u.resume())}},100)}else if("article"==y){var d,l="/api/v2/help_center/sections.json?per_page=100",p=0;c=0;!function t(){$.get(l).done(function(e){d=void 0===d?e.sections:d.concat(e.sections),null!==(l=e.next_page)?(l+="&per_page=100",t()):p=1})}();var g=setInterval(function(){if(p){if(clearInterval(g),""==d)return;d.forEach(function(e){-1<e.description.indexOf("MAP-ID:"+a.data[0].section_id)&&(c=e.id)}),t="/api/v2/help_center/sections/"+c+"/articles.json";var e={article:{title:decodeURIComponent(a.data[0].title),comments_disabled:a.data[0].comments_disabled,draft:a.data[0].draft,promoted:a.data[0].promoted,position:a.data[0].position,locale:a.data[0].locale,label_names:a.data[0].label_names.split(","),body:decodeURIComponent(a.data[0].body)}};0<c?$.ajax({url:t,type:"POST",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(e),success:function(e){m++,f(v,"ready"),v.text("New article (ID:"+e.article.id+") created successfully."),$("#"+y+"Log").val($("#"+y+"Log").val()+"New article (ID:"+e.article.id+") created successfully.\n").trigger("change"),u.resume()},error:function(){b++,f(v,"error"),v.text("Failed to create a new article for backup article (ID:"+a.data[0].id+")."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Failed to create a new article for backup article (ID:"+a.data[0].id+").\n").trigger("change"),u.resume()}}):(f(v,"ready"),v.text("Skipping article (ID:"+a.data[0].id+") since it belongs to Help Center Admin category."),$("#"+y+"Log").val($("#"+y+"Log").val()+"Skipping article (ID:"+a.data[0].id+") since it belongs to Help Center Admin category.\n").trigger("change"),u.resume())}},100)}}function r(e,t){f(v,"error"),v.text("ERROR : "+e)}function c(){e=performance.now(),f(v,"good"),v.text(m+"/"+b+" restored in "+Math.floor(e-o)+" seconds."),$(".article-body button").attr("disabled",!1),$(".article-body button").each(function(){$(this).text($(this).attr("name"))})}function a(a,e){h=b=m=0,v=$("#restore"+a+"Status"),y=a,$("#"+y+"Log").val("").trigger("change"),$(".article-body button").attr("disabled",!0),$(".article-body button").text("PROCESSING RESTORE");var t={delimiter:"",newline:"\r\n",header:!0,dynamicTyping:!1,preview:0,encoding:"",worker:!1,comments:"",step:n,complete:c,error:r,download:!1,fastMode:!1,skipEmptyLines:!1,chunk:void 0,beforeFirstChunk:void 0,withCredentials:void 0};0<$("#"+a+"CSVupload")[0].files.length?(o=performance.now(),$("#"+a+"CSVupload").parse({config:t,before:function(e,t){if(f(v,"ready"),v.text("Restoring from back up file: "+e.name),$("#"+y+"Log").val($("#"+y+"Log").val()+"Restoring from back up file: "+e.name+"\n").trigger("change"),-1==e.name.indexOf(a.toLowerCase()))return{action:"abort",reason:"Backup file name does not match "+a.toLowerCase()+" type."}},error:function(e,t,a,o){f(v,"error"),v.text(o),$(".article-body button").attr("disabled",!1),$(".article-body button").each(function(){$(this).text($(this).attr("name"))})},complete:function(){f(v,"good"),v.text(toTitleCase(a)+" restoration completed successfully."),$("#"+y+"Log").val($("#"+y+"Log").val()+m+"/"+h+" "+a+" items restored successfully.\n").trigger("change")}})):(f($(v),"error"),v.text("Please select the back up file to restore."),$(".article-body button").attr("disabled",!1),$(".article-body button").each(function(){$(this).text($(this).attr("name"))}))}$("#restoreCategoryBtn").click(function(){a("category",$(this))}),$("#restoreSectionBtn").click(function(){a("section",$(this))}),$("#restoreArticleBtn").click(function(){a("article",$(this))}),$($(".article-body input")).on("change",function(){if(-1<$(this).attr("id").indexOf("CSVupload")){var e=$(this).attr("id").split("CSVupload");f($("#restore"+e[0]+"Status"),"ready"),$("#restore"+e[0]+"Status").text(toTitleCase(e[0])+" restore not started.")}})});